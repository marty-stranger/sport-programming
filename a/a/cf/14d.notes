http://codeforces.ru/blog/entry/382 - someone says about O(n)
http://www.spoj.pl/problems/TWOPATHS/
The longest path in a tree can be found by depth first search from each leaf. 
http://codeforces.ru/contest/14/submission/63703
